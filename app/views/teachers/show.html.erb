<div class="container" id="teacher_container">
  <div class="row">

    <!-- Left column -->
    <div class="col-md-9">

      <!-- Basic Info -->
      <div class="panel panel-default">
          <div class="panel-body">
            <div class="col-md-3">
              <% if @teacher.profile_pic.url.nil? %>
                <img class="media-object profile-pic" src="https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcQV5Y81SdqnTLFEXe_h-4KA2uT4DuNhON4XU32Ut6JkTl2rFDEiOMnmOA" alt="..." height="126" width="126">
              <% else %>
                <img class="media-object profile-pic" src=<%= @teacher.profile_pic.url %> alt="..." height="126" width="126">
              <% end %>
            </div>
            <div class="col-md-9">
              <div class="col-md-9">
                <div class="col-md-12">
                  <h3><%= @teacher.name %></h3>
                </div>
                <!--<h5>Location : <%#= @teacher.teacher_info.location %></h5>-->
                <!--
                <div class="btn-group" role="group">
                  <a class="btn btn-default">
                    Rating
                    <br>
                    <%#= @teacher.teacher_info.rating %>
                  </a>
                  <a class="btn btn-primary">
                    Students
                    <br>
                    <%#= @teacher.teacher_info.student_number %>
                  </a>
                  <a class="btn btn-success">
                    Lessons
                    <br>
                    <%#= @teacher.teacher_info.lecture_number %>
                  </a>
                </div>
                -->
                <div class="col-md-12">
                  <h5><b>가르치는 언어 </b>
                    <% if !@teacher.lang_to_teach_1.nil? %>
                      <%= @teacher.lang_to_teach_1 %>(<%= @teacher.rank_to_teach_1 %>)
                    <% end %>
                    <% if !@teacher.lang_to_teach_2.nil? %>
                      <%= @teacher.lang_to_teach_2 %>(<%= @teacher.rank_to_teach_2 %>)
                    <% end %>
                  </h5>
                </div>
                <div class="col-md-12">
                  <h5><b>배우는 언어 </b>
                    <% if !@teacher.lang_to_learn_1.nil? %>
                      <%= @teacher.lang_to_learn_1 %>(<%= @teacher.rank_to_learn_1 %>)
                    <% end %>
                    <% if !@teacher.lang_to_learn_2.nil? %>
                      <%= @teacher.lang_to_learn_2 %>(<%= @teacher.rank_to_learn_2 %>)
                    <% end %>
                    <% if !@teacher.lang_to_learn_3.nil? %>
                      <%= @teacher.lang_to_learn_3 %>(<%= @teacher.rank_to_learn_3 %>)
                    <% end %>
                  </h5>
                </div>
              </div>
              <div class="col-md-3">
                <div class="col-md-12">
                  <h5 class="text-center">강의수</h5>
                  <h4 class="text-center"><b><%= @teacher.teacher_info.lecture_number %>회</b></h4>
                </div>
                <div class="col-md-12">
                  <h5 class="text-center">강의 평점</h5>
                  <h4 class="text-center"><b><%= @teacher.teacher_info.rating %>점</b></h4>
                </div>
                <div class="col-md-12">
                  <h5 class="text-center">강의료</h5>
                  <h4 class="text-center"><b><%= @teacher.teacher_info.lecture_price %>코인</b></h4>
                </div>
              </div>  
            </div>
            
            
          </div>
        </div>
      <!-- Basic Info -->

      <!-- Self intro -->
      <div class="panel panel-default">
        <div class="panel-body">
          <h3>소개</h3>
          <hr>
          <%= @teacher.teacher_info.introduction %>
        </div>
      </div>
      <!-- Self intro -->

      <!-- Certificate intro -->
      <!-- 불필요 정보 비활성화
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3>Education</h3>
            <hr>
            Studied <%#= @teacher.teacher_info.major %> in <%#= @teacher.teacher_info.school_grad %>
          <h3>Certificates</h3>
          <hr>
          </div>
        </div>
      </div>
      -->
      <!-- Certificate intro -->

      <!-- Comments -->
      <div class="panel panel-default">
          <div class="panel-body">
            <h3>강의 후기</h3>
            <hr>

            <div class="col-md-12">
              <% if @teacher.comments.empty? %>
                There's no comment.
              <% else %>

                <% @teacher.comments.each do |c| %>
                  <div class="media">
                    <div class="col-md-2">
                      <div class="media-left">
                        <% if User.unscoped{ c.commentor.profile_pic.url.nil? } %>
                          <img src="http://thesocialmediamonthly.com/wp-content/uploads/2015/08/photo.png" class="profile-pic" height="50" width="50"/>
                        <% else %>
                          <img src=<%= User.unscoped{ c.commentor.profile_pic.url } %> class="profile-pic" height="50" width="50"/>
                        <% end %>
                      </div>
                    </div>
                    <div class="col-md-9">
                      <div class="media-body">
                        <h4 class="media-heading"> <%= User.unscoped{ c.commentor.name } %> </h4>
                        <%= c.text %>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <% if User.unscoped{ c.commentor == current_user } %>
                        <%= link_to destroy_teacher_comment_path(c), method: :delete do %>
                          <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                <% end %>

              <% end %>
            </div>
            <div class="col-md-12">
              <hr>
              <div class="form-group">
                <%= form_for :new_comment, url: teacher_comments_path(@teacher) do |f| %>
                  <div class="col-md-10">
                    <%= f.text_field :text, class: "form-control", placeholder: "후기를 남겨주세요" %>
                  </div>
                  <div class="col-md-2">
                    <%= f.submit "완료", class: "btn btn-default" %>
                  </div>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      <!-- Comments -->

      <!-- Schedule -->
      <!--
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3> Schedule </h3>
            <hr>
            <table class="table table-striped table-hover ">
              <thead>
                <tr>
                  <th class="col-md-2">#</th>
                  <th class="col-md-2">Mon</th>
                  <th class="col-md-2">Tue</th>
                  <th class="col-md-2">Wed</th>
                  <th class="col-md-2">Thu</th>
                  <th class="col-md-2">Fri</th>
                </tr>
              </thead>
              <tbody>
                <%# 10.upto(22).each do |h| %>
                  <tr>
                    <th><%#= h %>:00 - <%#= h+1 %>:00</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>
                <%# end %>
              </tbody>
            </table>
          </div>
        </div>
      </div> -->
      <!-- Schedule -->

    </div>
    <!-- Left column -->

    <!-- Right column -->
    <% if current_user.id != @teacher.id %>
      <div class="col-md-3">
        <div id="lessonSelect" class="panel panel-default">
          <form class="panel-body">
            <div class="panel-body">
              <div id="alert-teacher" class="alert alert-danger" role="alert" style="display: none;"><b></b></div>
              
                <!--<%#= @teacher.teacher_info.lecture_price %> coins / 1 hour-->
              
              
              <!-- Section - Select Time -->
              <div class="input-group">
                <button type="button" class="btn btn-primary col-md-12" data-toggle="modal" data-target="#selectTimeModal">
                  강의 시간 선택
                </button>
                <input type="text" name="selectTimeInput" id="selectTimeInput" class="form-control" placeholder="강의 시간을 선택해 주세요" disabled>
                
                <!-- Modal For select time-->
                <div class="modal fade" id="selectTimeModal" tabindex="-1" role="dialog" aria-labelledby="selectTimeLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="selectTimeLabel">
                          강의 시간 선택<br>
                          <span style="font-size: 12px; color: #aaa;">선생님이 등록한 시간대가 연두색으로 표시됩니다. 선생님이 등록하지 않은 시간도 신청 가능합니다.</span>
                        </h4>
                      </div>
                      <div class="modal-body">
                        <div class="go-demo-box"></div>
                        <!-- Event Calendar by DayPilot -->
                        <div id="dp"></div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="passSelectTime(eventStatic)">선택</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
 
              <!-- Section - Curriculum -->
              <div class="input-group">
                <button type="button" class="btn btn-primary col-md-12" data-toggle="modal" data-target="#curriculumModal">
                  커리큘럼 선택
                </button>
                <input type="hidden" name="courseId" id="courseId">
                <input type="text" id="courseSubject" class="form-control" placeholder="커리큘럼을 선택해 주세요" disabled>
 
                <!-- Modal For Curriculum -->
                <%= render partial: 'teachers/curriculum_modal' %>
 
              </div>
 
              <!-- Section - Confirm Lecture -->
              <div class="input-group">
                <button type="button" class="btn btn-success col-md-12" data-toggle="modal" data-target="#applyModal">
                  강의 신청
                </button>
                
                <!-- Modal For Apply Lecture -->
                <div class="modal fade" id="applyModal" tabindex="-1" role="dialog" aria-labelledby="applyLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="applyLabel">강의 신청</h4>
                      </div>
                      <div class="modal-body">
                        <div class="well">
                          <p><b>선생님 : <%= @teacher.name %></b></p>
                          <p><b>강의료 : <%= @teacher.teacher_info.lecture_price %> 코인</b></p>
                          <p><b>강의 시간 : <span class="selectTimeInput"></span></b></p>
                          <p><b>커리큘럼 : <span class="courseSubject"></span></b></p>
                        </div>
                        <div class="well">
                          강의 신청 전에 아래의 사항들을 확인해 주세요.
                          <p><input type="checkbox" required>상대방이 24시간 안에 답변하지 않으면 신청한 강의는 자동으로 취소되고 코인이 환불됩니다.</p>
                          <p><input type="checkbox" required>상대방이 수업시간 24시간 전까지 답변하지 않으면 신청한 강의는 자동으로 취소되고 코인이 환불됩니다.</p>
                          <p><input type="checkbox" required>상대방 승인 이전에는 자유롭게 수업 취소가 가능합니다.</p>
                          <p><input type="checkbox" required>상대방 승인 후에는 기준 시점인 수업 시간 24시간 이전까지만 취소가 가능합니다.</p>
                          <p><input type="checkbox" required>기준 시점 경과 후에는 전체 환불을 받을 수 없습니다.</br>
                          &nbsp&nbsp- 수업시간 12시간 전까지 취소할 경우 강의료의 50%를 환불 받을 수 있습니다.</br>
                          &nbsp&nbsp-	수업시간 12시간 전 시점 경과 시 수업료를 환불 받을 수 없습니다.</p>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button id="lesson_submit_btn" type="button" class="btn btn-primary">신청</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Section - Confirm Free Lecture -->
              <div class="input-group">
                <button type="button" class="btn btn-success col-md-12" data-toggle="modal" data-target="#applyFreeModal">
                  무료 매칭 신청
                </button>
                
                <!-- Modal For Apply Free Lecture -->
                <div class="modal fade" id="applyFreeModal" tabindex="-1" role="dialog" aria-labelledby="applyFreeLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="applyFreeLabel">무료 매칭 신청</h4>
                      </div>
                      <div class="modal-body">
                        <div class="well">
                          <p>선생님 : <%= @teacher.name %></p>
                          <p>강의료 : <%= @teacher.teacher_info.lecture_price %> 코인</p>
                          <p>강의 시간 : <span class="selectTimeInput"></span></p>
                          <p>커리큘럼 : <span class="courseSubject"></span></p>
                        </div>
                        <div class="well">
                          강의 신청 전에 아래의 사항들을 확인해 주세요.
                          <p><input type="checkbox" required>상대방이 24시간 안에 답변하지 않으면 신청한 강의는 자동으로 취소됩니다.</p>
                          <p><input type="checkbox" required>상대방이 수업시간 24시간 전까지 답변하지 않으면 신청한 강의는 자동으로 취소됩니다.</p>
                          <p><input type="checkbox" required>상대방 승인 이전에는 자유롭게 신청 취소가 가능합니다.</p>
                          <p><input type="checkbox" required>상대방 승인 후에는 기준 시점인 강의 시간 24시간 이전까지만 취소가 가능합니다.</p>
                          <p><input type="checkbox" required>기준 시점 경과 후에는 전체 환불을 받을 수 없습니다.</br>
                          &nbsp&nbsp- 강의시간 12시간 전까지 취소할 경우 강의료의 50%를 환불 받을 수 있습니다. 내용 수정 필요</br>
                          &nbsp&nbsp-	강의시간 12시간 전 시점 경과 시 수업료를 환불 받을 수 없습니다. 내용 수정 필요</p>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button id="free_lesson_submit_btn" type="button" class="btn btn-primary">신청</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!--<%= link_to "무료 매칭 신청", select_time_path(@teacher), class: "btn btn-success col-md-12" %>-->
            </div>
          </form>
        </div>

<%# following is deleted %>
<%#
        <div class="panel panel-default">
          <div class="panel-body">
            <h4>
              Contact
            </h4>
            <hr>
            <h4>
              900 Chips for 1 hour
            </h4>
            <a href="#" class="btn btn-default col-md-12">Send a Message</a>
          </div>
        </div>
%>
      </div>
    <% end %>
    <!-- Right column -->

  </div>
</div>

<script src="/assets/daypilot-all.min.js" type="text/javascript"></script>
<script src="/assets/mySchedule.js" type="text/javascript"></script>
<script type="text/javascript">
  var my_avail = new Teacher_Schedule('<%= User.find(params[:id].to_i).get_schedule %>');
  var dp = new DayPilot.Calendar("dp");
  show_availables_on_calendar(dp,my_avail);
  dp.viewType = "Week";
  dp.eventMoveHandling = "Disabled";
  dp.theme = "langdy";
  dp.init();
  
  loadEvents();
  
  eventStatic = null; // 이벤트 전역 변수
  // 셀렉트 이벤트 바인딩
  dp.onTimeRangeSelected = function (args) {
    name = "name";
    var e = new DayPilot.Event({
        start: args.start,
        end: args.end,
        id: DayPilot.guid(),
        resource: args.resource,
        text: name
    });
    
    eventStatic = e;
    // dp.events.add(e);
    
    // $('#selectTimeModal').modal("hide");
  };
  
  function loadEvents() {
    $.post("/get_lessons",
    {
        user_id: <%= @teacher.id %>,
        start: "'" + dp.visibleStart().toString().replace("T", " [").concat("]'"),
        end: "'" + dp.visibleEnd().toString().replace("T", " [").concat("]'")
    }, 
    function(data, status, xhr) {
        dp.events.list = data;
        dp.update();
    });
  }
</script>

<script tpye="text/javascript">
  loadCourses();
</script>

<script>
  $(document).ready(function(){
    $('#lesson_submit_btn').click(function(){
      submitLesson(<%= @teacher.id %>, <%= @teacher.teacher_info.lecture_price %>, false);
    });
    $('#free_lesson_submit_btn').click(function(){
      submitLesson(<%= @teacher.id %>, <%= @teacher.teacher_info.lecture_price %>, true);
    });
    $('#curri_btn').click(function(){
      passSelectCourse()
    });
  });
</script>
