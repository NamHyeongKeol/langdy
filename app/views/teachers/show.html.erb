<div class="container" id="teacher_container">
  <div class="row">

    <!-- Left column -->
    <div class="col-md-9">

      <!-- Basic Info -->
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="col-md-3">
              <% if @teacher.profile_pic.url.nil? %>
                <img class="media-object profile-pic" src="https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcQV5Y81SdqnTLFEXe_h-4KA2uT4DuNhON4XU32Ut6JkTl2rFDEiOMnmOA" alt="..." height="126" width="126">
              <% else %>
                <img class="media-object profile-pic" src=<%= @teacher.profile_pic.url %> alt="..." height="126" width="126">
              <% end %>
            </div>
            <div class="col-md-9">
              <h2><%= @teacher.name %></h2>
              <h5>Location : <%= @teacher.teacher_info.location %></h5>
              <br>
              <div class="btn-group" role="group">
                <a class="btn btn-default">
                  Rating
                  <br>
                  <%= @teacher.teacher_info.rating %>
                </a>
                <a class="btn btn-primary">
                  Students
                  <br>
                  <%= @teacher.teacher_info.student_number %>
                </a>
                <a class="btn btn-success">
                  Lessons
                  <br>
                  <%= @teacher.teacher_info.lecture_number %>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Basic Info -->

      <!-- Self intro -->
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3>Introduction</h3>
            <hr>
            <%= @teacher.teacher_info.introduction %>
          </div>
        </div>
      </div>
      <!-- Self intro -->

      <!-- Certificate intro -->
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3>Education</h3>
            <hr>
            Studied <%= @teacher.teacher_info.major %> in <%= @teacher.teacher_info.school_grad %>
          <h3>Certificates</h3>
          <hr>
          </div>
        </div>
      </div>
      <!-- Certificate intro -->

      <!-- Comments -->
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3>Comments</h3>
            <hr>

            <div class="col-md-12">
              <% if @teacher.comments.empty? %>
                There's no comment.
              <% else %>

                <% @teacher.comments.each do |c| %>
                  <div class="media">
                    <div class="col-md-2">
                      <div class="media-left">
                        <a href="#">
                          <img src="http://thesocialmediamonthly.com/wp-content/uploads/2015/08/photo.png" class="media-object profile-pic col-md-12"/>
                        </a>
                      </div>
                    </div>
                    <div class="col-md-9">
                      <div class="media-body">
                        <h4 class="media-heading"> <%= c.commentor.name %> </h4>
                        <%= c.text %>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <% if c.commentor == current_user %>
                        <%= link_to destroy_teacher_comment_path(c), method: :delete do %>
                          <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                <% end %>

              <% end %>
            </div>
            <div class="col-md-12">
              <hr>
              <div class="form-group">
                <%= form_for :new_comment, url: teacher_comments_path(@teacher) do |f| %>
                  <div class="col-md-10">
                    <%= f.text_field :text, class: "form-control", placeholder: "Leave a comment" %>
                  </div>
                  <div class="col-md-2">
                    <%= f.submit "Submit", class: "btn btn-default" %>
                  </div>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      </div>
      <!-- Comments -->

      <!-- Schedule -->
      <!--
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3> Schedule </h3>
            <hr>
            <table class="table table-striped table-hover ">
              <thead>
                <tr>
                  <th class="col-md-2">#</th>
                  <th class="col-md-2">Mon</th>
                  <th class="col-md-2">Tue</th>
                  <th class="col-md-2">Wed</th>
                  <th class="col-md-2">Thu</th>
                  <th class="col-md-2">Fri</th>
                </tr>
              </thead>
              <tbody>
                <% 10.upto(22).each do |h| %>
                  <tr>
                    <th><%= h %>:00 - <%= h+1 %>:00</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div> -->
      <!-- Schedule -->

    </div>
    <!-- Left column -->

    <!-- Right column -->
    <% if current_user.id != @teacher.id %>
      <div class="col-md-3">
        <div id="lessonSelect" class="panel panel-default">
          <form class="panel-body">
            <div class="panel-body">
              <div id="alert-teacher" class="alert alert-danger" role="alert" style="display: none;"><b></b></div>
              
              <h4> If you want to start lessons </h4>
              <hr>
              <h4 style="margin-top: 50px;">
                <%= @teacher.teacher_info.lecture_price %> coins / 1 hour
              </h4>
              
              <!-- Section - Select Time -->
              <div class="input-group">
                <button type="button" class="btn btn-primary col-md-12" data-toggle="modal" data-target="#selectTimeModal">
                  강의 시간 선택
                </button>
                <input type="text" name="selectTimeInput" id="selectTimeInput" class="form-control" placeholder="강의 시간을 선택해 주세요" disabled>
                
                <!-- Modal For select time-->
                <div class="modal fade" id="selectTimeModal" tabindex="-1" role="dialog" aria-labelledby="selectTimeLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="selectTimeLabel">
                          강의 시간 선택<br>
                          <span style="font-size: 12px; color: #aaa;">선생님이 등록한 시간대가 연두색으로 표시됩니다. 선생님이 등록하지 않은 시간도 신청 가능합니다.</span>
                        </h4>
                      </div>
                      <div class="modal-body">
                        <!-- Event Calendar by DayPilot -->
                        <div id="dp"></div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="passSelectTime(eventStatic)">선택</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
 
              <!-- Section - Curriculum -->
              <div class="input-group">
                <button type="button" class="btn btn-primary col-md-12" data-toggle="modal" data-target="#curriculumModal">
                  커리큘럼 선택
                </button>
                <input type="hidden" name="courseId" id="courseId">
                <input type="text" id="courseSubject" class="form-control" placeholder="커리큘럼을 선택해 주세요" disabled>
 
                <!-- Modal For Curriculum -->
                <%= render partial: 'teachers/curriculum_modal' %>
 
              </div>
 
              <!-- Section - Confirm Lecture -->
              <div class="input-group">
                <button type="button" class="btn btn-success col-md-12" data-toggle="modal" data-target="#applyModal">
                  강의 신청
                </button>
                
                <!-- Modal For Apply Lecture -->
                <div class="modal fade" id="applyModal" tabindex="-1" role="dialog" aria-labelledby="applyLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="applyLabel">강의 신청</h4>
                      </div>
                      <div class="modal-body">
                        <div class="well">
                          <p><b>선생님 : <%= @teacher.name %></b></p>
                          <p><b>강의료 : <%= @teacher.teacher_info.lecture_price %> 코인</b></p>
                          <p><b>강의 시간 : <span class="selectTimeInput"></span></b></p>
                          <p><b>커리큘럼 : <span class="courseSubject"></span></b></p>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button id="lesson_submit_btn" type="button" class="btn btn-primary">예</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">아니오</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Section - Confirm Free Lecture -->
              <div class="input-group">
                <button type="button" class="btn btn-success col-md-12" data-toggle="modal" data-target="#applyFreeModal">
                  무료 매칭 신청
                </button>
                
                <!-- Modal For Apply Free Lecture -->
                <div class="modal fade" id="applyFreeModal" tabindex="-1" role="dialog" aria-labelledby="applyFreeLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="applyFreeLabel">무료 매칭 신청</h4>
                      </div>
                      <div class="modal-body">
                        <div class="well">
                          <p><b>선생님 : <%= @teacher.name %></b></p>
                          <p><b>강의료 : <%= @teacher.teacher_info.lecture_price %> 코인</b></p>
                          <p><b>강의 시간 : <span class="selectTimeInput"></span></b></p>
                          <p><b>커리큘럼 : <span class="courseSubject"></span></b></p>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button id="free_lesson_submit_btn" type="button" class="btn btn-primary">예</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">아니오</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!--<%= link_to "무료 매칭 신청", select_time_path(@teacher), class: "btn btn-success col-md-12" %>-->
            </div>
          </form>
        </div>

<%# following is deleted %>
<%#
        <div class="panel panel-default">
          <div class="panel-body">
            <h4>
              Contact
            </h4>
            <hr>
            <h4>
              900 Chips for 1 hour
            </h4>
            <a href="#" class="btn btn-default col-md-12">Send a Message</a>
          </div>
        </div>
%>
      </div>
    <% end %>
    <!-- Right column -->

  </div>
</div>

<script src="/assets/daypilot-all.min.js" type="text/javascript"></script>
<script src="/assets/mySchedule.js" type="text/javascript"></script>
<script type="text/javascript">
  var my_avail = new Teacher_Schedule('<%= User.find(params[:id].to_i).get_schedule %>');
  var dp = new DayPilot.Calendar("dp");
  show_availables_on_calendar(dp,my_avail);
  dp.viewType = "Week";
  dp.eventMoveHandling = "Disabled";
  dp.init();
  
  loadEvents();
  
  eventStatic = null; // 이벤트 전역 변수
  // 셀렉트 이벤트 바인딩
  dp.onTimeRangeSelected = function (args) {
    name = "name";
    var e = new DayPilot.Event({
        start: args.start,
        end: args.end,
        id: DayPilot.guid(),
        resource: args.resource,
        text: name
    });
    
    eventStatic = e;
    // dp.events.add(e);
    
    // $('#selectTimeModal').modal("hide");
  };
  
  function loadEvents() {
    $.post("/get_lessons",
    {
        user_id: <%= @teacher.id %>,
        start: "'" + dp.visibleStart().toString().replace("T", " [").concat("]'"),
        end: "'" + dp.visibleEnd().toString().replace("T", " [").concat("]'")
    }, 
    function(data, status, xhr) {
        dp.events.list = data;
        dp.update();
    });
  }
</script>

<script src="/assets/bootstrap-treeview.js"></script>
<script tpye="text/javascript">
  function loadCourses() {
    $.post("/get_courses",
    {
        lang: '<%= @teacher.native_lang %>',
        mi_selectable: true, //미수강 선택가능 여부
        ye_selectable: true, //수강예정 선택가능 여부
        wa_selectable: true, //수강 완료 선택가능 여부
    },
    function(data, status, xhr) {
        loadCoursesCallback(data);
    });
  }

  function loadCoursesCallback(treeData) {
    $('#tree').treeview({
      data: treeData,
      showTags: true
    });
  }

  loadCourses();
</script>

<script>
  $(document).ready(function(){
    $('#lesson_submit_btn').click(function(){
      submitLesson(<%= @teacher.id %>, 900, false);
    });
    $('#free_lesson_submit_btn').click(function(){
      submitLesson(<%= @teacher.id %>, 900, true);
    });
    $('#curri_btn').click(function(){
      passSelectCourse()
    });
  });
</script>
